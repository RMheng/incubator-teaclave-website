(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{421:function(t,e,n){"use strict";n.r(e);var a=n(27),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"write-functions-in-python"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#write-functions-in-python"}},[t._v("#")]),t._v(" Write Functions in Python")]),t._v(" "),n("p",[t._v("The Teaclave platform provides a convenient way to register a customized\nfunction written in Python, and the function is interpreted at runtime in an\nisolated trusted execution environment (i.e., Intel SGX).")]),t._v(" "),n("h2",{attrs:{id:"entrypoint"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[t._v("#")]),t._v(" Entrypoint")]),t._v(" "),n("p",[t._v("Here is an simple example of an echo function:")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("entrypoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'message'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("is")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("not")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("None")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" argv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("p",[t._v("The "),n("code",[t._v("entrypoint")]),t._v(' function defined above is the "entrypoint" to executing the\nfunction. It takes one argument which is a list of arguments of this echo\nfunction. The return value of the '),n("code",[t._v("entrypoint")]),t._v(" function will be passed back to\nthe client.")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),n("p",[t._v("Note that the function arguments in key-value format passed from the platform\nare flattened into a list. For example, the "),n("code",[t._v('{"message": "Hello, Teaclave!"}')]),t._v("\narguments will become "),n("code",[t._v('"message"')]),t._v(" ("),n("code",[t._v("argv[0]")]),t._v(") and "),n("code",[t._v('"Hello, Teaclave!"')]),t._v("\n("),n("code",[t._v("argv[1]")]),t._v(").")])]),t._v(" "),n("h2",{attrs:{id:"modules"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#modules"}},[t._v("#")]),t._v(" Modules")]),t._v(" "),n("p",[t._v("Current Python executor (i.e., MesaPy) already supports many modules of the\noriginal Python standard library such as "),n("code",[t._v("marshal")]),t._v(", "),n("code",[t._v("math")]),t._v(", "),n("code",[t._v("binascii")]),t._v(",\n"),n("code",[t._v("itertools")]),t._v(", "),n("code",[t._v("micronumpy")]),t._v(". You can find a full list of available modules in the\n"),n("a",{attrs:{href:"https://github.com/mesalock-linux/mesapy/blob/sgx/sgx/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("document of MesaPy for SGX"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("p",[t._v("Besides these modules for general computation, you may curious about doing file\nI/O in customized Python function. We provides APIs to integrated with the\nexecutor runtime to read/write files registered along with the task. You can\neither open a file through the "),n("code",[t._v("teaclave_open")]),t._v(" function or with the "),n("code",[t._v("teaclave")]),t._v("\nmodule like this:")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# open input via built-in teaclave_open")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" teaclave_open"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input_file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rb"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    line "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readline"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# open input via teaclave module")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" teaclave "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"output_file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wb"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"This message is from Mesapy!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("Either function will give an "),n("code",[t._v("file")]),t._v(" object in Python, you can use it to read\nlines or write data. And the first argument is the key of the registered\ninput/output files.")]),t._v(" "),n("p",[t._v("You can learn more about advanced usages in the example of\n"),n("a",{attrs:{href:"https://github.com/apache/incubator-teaclave/tree/master/examples/python",target:"_blank",rel:"noopener noreferrer"}},[t._v("logistic regression in Python"),n("OutboundLink")],1),t._v(".")])])}),[],!1,null,null,null);e.default=s.exports}}]);